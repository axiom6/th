function init(){function e(e,n){for(var t=e.attributes.position,r=[],o=0;o<t.count;o++)r.push(n.r,n.g,n.b);e.addAttribute("color",new THREE.Float32BufferAttribute(r,3))}container=document.getElementById("container"),camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1e4),camera.position.z=1e3,controls=new THREE.TrackballControls(camera),controls.rotateSpeed=1,controls.zoomSpeed=1.2,controls.panSpeed=.8,controls.noZoom=!1,controls.noPan=!1,controls.staticMoving=!0,controls.dynamicDampingFactor=.3,scene=new THREE.Scene,scene.background=new THREE.Color(16777215),pickingScene=new THREE.Scene,pickingTexture=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight),pickingTexture.texture.minFilter=THREE.LinearFilter,scene.add(new THREE.AmbientLight(5592405));var n=new THREE.SpotLight(16777215,1.5);n.position.set(0,500,2e3),scene.add(n);for(var t=new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}),r=new THREE.MeshPhongMaterial({color:16777215,flatShading:!0,vertexColors:THREE.VertexColors,shininess:0}),o=[],i=[],a=new THREE.Matrix4,s=new THREE.Quaternion,c=new THREE.Color,d=0;d<5e3;d++){var E=new THREE.BoxBufferGeometry,h=new THREE.Vector3;h.x=1e4*Math.random()-5e3,h.y=6e3*Math.random()-3e3,h.z=8e3*Math.random()-4e3;var l=new THREE.Euler;l.x=2*Math.random()*Math.PI,l.y=2*Math.random()*Math.PI,l.z=2*Math.random()*Math.PI;var m=new THREE.Vector3;m.x=200*Math.random()+100,m.y=200*Math.random()+100,m.z=200*Math.random()+100,s.setFromEuler(l,!1),a.compose(h,s,m),E.applyMatrix(a),e(E,c.setHex(16777215*Math.random())),o.push(E),E=E.clone(),e(E,c.setHex(d)),i.push(E),pickingData[d]={position:h,rotation:l,scale:m}}var g=new THREE.Mesh(THREE.BufferGeometryUtils.mergeBufferGeometries(o),r);scene.add(g),pickingScene.add(new THREE.Mesh(THREE.BufferGeometryUtils.mergeBufferGeometries(i),t)),highlightBox=new THREE.Mesh(new THREE.BoxBufferGeometry,new THREE.MeshLambertMaterial({color:16776960})),scene.add(highlightBox),renderer=new THREE.WebGLRenderer({antialias:!0}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),container.appendChild(renderer.domElement),stats=new Stats,container.appendChild(stats.dom),renderer.domElement.addEventListener("mousemove",onMouseMove)}function onMouseMove(e){mouse.x=e.clientX,mouse.y=e.clientY}function animate(){requestAnimationFrame(animate),render(),stats.update()}function pick(){renderer.render(pickingScene,camera,pickingTexture);var e=new Uint8Array(4);renderer.readRenderTargetPixels(pickingTexture,mouse.x,pickingTexture.height-mouse.y,1,1,e);var n=e[0]<<16|e[1]<<8|e[2],t=pickingData[n];t?t.position&&t.rotation&&t.scale&&(highlightBox.position.copy(t.position),highlightBox.rotation.copy(t.rotation),highlightBox.scale.copy(t.scale).add(offset),highlightBox.visible=!0):highlightBox.visible=!1}function render(){controls.update(),pick(),renderer.render(scene,camera)}var container,stats,camera,controls,scene,renderer,pickingData=[],pickingTexture,pickingScene,highlightBox,mouse=new THREE.Vector2,offset=new THREE.Vector3(10,10,10);init(),animate();